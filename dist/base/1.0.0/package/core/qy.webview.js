/*!
 * FastProgram Core
 * (c) 2018-2019 CrixusShen
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t():"function"==typeof define&&define.amd?define(t):t()}(0,function(){"use strict";var a={};function r(e){var t,n,o;return"text"===e.tag?t=document.createTextNode(e.text):"comment"===e.tag?t=document.createComment(e.text||e._uid):(t=e.ns?document.createElementNS(e.ns,e.tag):document.createElement(e.tag)).setAttribute("_uid",e._uid),n=e._uid,o=t,a[n]=o,t}function c(e){return a[e._uid]||r(e)}function u(e){return a[e.parent._uid]||r(e.parent)}var e=-1===location.protocol.indexOf("http"),n=!e,o=e&&void 0!==window.webkit,i=e&&!o;function f(e){return"[object Function]"===Object.prototype.toString.call(e)}function d(e,t){var n={type:e,data:t};s("native",JSON.stringify(n))}function s(e,t){console.log("[executeJS] target : "+e+" ; scriptContent : "+t),"thread"===e?(o&&window.webkit.messageHandlers.emit.postMessage(t),i&&console.log("execute:"+t),n&&new Function(t)()):"native"===e&&(o&&window.webkit.messageHandlers.native_call.postMessage(t),i&&console.log("hal:"+t),n&&console.log("[webview] error : native call "+t))}function l(e){return{hoverLeft:(e=e.getBoundingClientRect()).left,hoverTop:e.top,left:e.left+window.scrollX,top:e.top+window.scrollY}}function t(e){var t={};t.id=e,t.action="delete",d("nativeBox",t)}function v(a){function e(e,n){void 0===n&&(n=[]);for(var o=[],i=a.changedTouches.length,t=function(){var t=a.changedTouches[i];n.forEach(function(e){(o[i]=o[i]||[])[e]=t[e]})};i--;)t();return o}function t(t,e){void 0===e&&(e=[]);var n={};return e.forEach(function(e){n[e]=t[e]}),n._uid=t.getAttribute("_uid"),n}-1<a.type.indexOf("touch")&&(this.changedTouches=e(a.changedTouches,["clientX","clientY","pageX","pageY"]),this.touches=e(a.touches,["clientX","clientY","identifier","pageX","pageY"]),this.realTarget=t(document.elementFromPoint(this.touches[0].clientX,this.touches[0].clientY))),this.currentTarget=t(a.currentTarget,["dataset","id","offsetLeft","offsetTop"]),this.detail=a.detail||{value:a.target.value},this.target=t(a.target,["dataset","id","offsetLeft","offsetTop"]),this.timeStamp=a.timeStamp}function _(){var e=document.getElementById("page");if(!e.children||0===e.children.length){var t=function(){if(a[0])return a[0];console.error("[qy webview] error at getRoot")}();t&&document.getElementById("page").appendChild(t)}}var g=Object.freeze({init:_,appendCh:function(e){var t=c(e);u(e).appendChild(t)},removeCh:function(e){var t=c(e);t&&t.parentNode.removeChild(t)},insertBefore:function(e){var t,n=u(e),o=c(e),i=(t=e).ref?a[t.ref._uid]||r({_uid:t.ref._uid,tag:t.ref.tag}):null;n.insertBefore(o,i)},setAttr:function(e){var t=c(e);"INPUT"===t.tagName&&"value"===e.key?t.value=e.val:t.setAttribute(e.key,e.val)},removeAttr:function(e){c(e).removeAttribute(e.key)},setClass:function(e){c(e).className=e.cls},setStyle:function(e){var t=c(e);Object.assign(t.style,e.style)},setText:function(e){c(e).textContent=e.text},createNative:function(e){var t,n,o,i,a,r;t=e._uid,n=c(e),o=e.nativeTag,i=e.hover,a=e.data,(r={}).top=i?l(n).hoverTop:l(n).top,r.left=i?l(n).hoverLeft:l(n).left,r.height=n.offsetHeight,r.width=n.offsetWidth,r.type=o,r.viewData=a,r.hover=i,r.id=t,r.action="create",d("nativeBox",r)},removeNative:function(e){t(e._uid)},updateNative:function(e){t(e._uid)},addEvent:function(a){c(a).addEventListener(a.event,function(e){var t,n,o,i;n=(t=a).event,o=new v(e),i="__thread__.getEvent({",t&&(i+="_uid:"+t._uid),n&&(i+=",event:'"+n+"'"),o&&(i+=",params:"+JSON.stringify(o)),s("thread",i+="})")})},removeEvent:function(e,t){},webviewApiCall:function(e){if(!__webview__||!__webview__.api)return console.log("api is not ready"),!1;var t=__webview__.api;if(e.fn.split(".").map(function(e){if(!(t=t[e]))return console.log("__webview__.api "+t+" is not registered"),!1}),!f(t))return console.log("__webview__.api "+t+" is not a function"),!1;t(e.params)},webviewComCall:function(e){var t=window.__webview__.component;return t?f(t[e.fn])?void t[e.fn].call(c(e),e.params):(console.log("component "+e.fn+" is not registered"),!1):(console.log("__component__ is not ready"),!1)}});var h=["direct_dom","direct_attr","direct_api","direct_com","direct_native"];function w(t){h.forEach(function(e){t[e].forEach(function(e){g[e.op].call(null,e.val)}),"direct_dom"===e&&_()})}function p(e,t,n){if("addEventListener"in window)return e.addEventListener(t,n,!1)}function m(e,t){if(document.createEvent)return console.log("["+t+"] fired"),e.target.dispatchEvent(function(e){if(document.createEvent){var t=window.document.createEvent("HTMLEvents");return t.initEvent(e,!0,!0),t.eventName=e,t}}(t))}function b(e){return e.originalEvent&&e.originalEvent.touches&&e.originalEvent.touches.length?e.originalEvent.touches[0]:e.touches&&e.touches.length?e.touches[0]:e}function E(){!function(t){void 0===t&&(t={fingerMaxOffset:11});var n={},e=function(e){e=b(e),n.start=[e.pageX,e.pageY],n.offset=[0,0]},o=function(e){if(!n.start&&!n.move)return!1;e=b(e),n.move=[e.pageX,e.pageY],n.offset=[Math.abs(n.move[0]-n.start[0]),Math.abs(n.move[1]-n.start[1])],n.offset&&(n.offset[0]>t.fingerMaxOffset||n.offset[1]>t.fingerMaxOffset)&&(n={})},i=function(e){e=b(e),n.offset&&n.offset[0]<t.fingerMaxOffset&&n.offset[1]<t.fingerMaxOffset&&m(e,"tap"),n={}};p(window,"load",function(){p(document.documentElement,"touchstart",e),p(document.documentElement,"touchmove",o),p(document.documentElement,"touchend",i)})}()}var y=Object.freeze({triggerCallback:function(e){s("thread","__thread__.callback.triggerCallback( "+e+" )")}});"addEventListener"in document&&document.addEventListener("DOMContentLoaded",function(){n&&window.__patchQueue__&&Array.isArray(window.__patchQueue__)&&window.__patchQueue__.forEach(function(e){w(e)}),window.__bridge__={on_recv_patch_command:function(e){w(e)}},e&&(o&&window.webkit.messageHandlers.finish_construct.postMessage(0),i&&console.log("hal:"+JSON.stringify({type:"bridgeLoadFinish",data:{finished:!0},intercept:!1}))),E()},!1),window.__webview__=window.__webview__||{},window.__webview__.bridge={executeJS:s},window.__webview__.callback=y});